# yt-dlp UI

一个本地可运行的 `yt-dlp` 图形界面（Flask）。

## 功能

- 输入 URL 下载视频或音频
- 解析视频信息（标题、作者、时长、格式列表）
- 下拉选择格式，或手动输入 `-f` 表达式
- 支持播放列表开关
- 支持附加参数（如 cookies、代理）
- 实时进度、完整日志、输出文件路径展示
- 任务取消
- 失败自动重试（可配置重试次数）
- 支持重试策略覆盖（固定间隔 / 指数退避）
- 支持代理池重试轮换（每任务可配置多代理）
- 失败/完成任务手动重排队
- 批量队列下载（每行一个 URL，按顺序执行）
- 下载完成桌面通知（浏览器授权后）
- 下载完成自动打开目录（可选开关）
- 一键打开当前任务输出目录
- 最近任务列表，可回看历史日志

## 依赖

- Python 3.10+
- `yt-dlp`
- （可选）`ffmpeg`，用于音频提取与格式转换

## 安装

```bash
cd /home/xxx/yt-dlp-ui
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -U pip
pip install -r requirements.txt
```

如果系统没有安装 `yt-dlp`，可执行：

```bash
python3 -m pip install -U yt-dlp
```

## 一键启动（推荐）

```bash
cd /home/xxx/yt-dlp-ui
./start.sh
```

首次运行会自动：
- 创建 `.venv` 虚拟环境
- 安装/更新 `requirements.txt` 依赖
- 检测并补装 `yt-dlp`（若系统与虚拟环境都不存在）

可选参数：
- `./start.sh --check`：只检查环境，不启动服务
- `./start.sh --no-browser`：启动服务但不自动打开浏览器

## 手动启动（旧方式）

```bash
cd /home/xxx/yt-dlp-ui
source .venv/bin/activate
python app.py
```

浏览器访问：`http://127.0.0.1:17800`

## 使用说明

- 先填链接，点“解析视频信息”获取格式选项
- 视频下载可直接选下拉格式，或在“自定义格式”填 `-f` 表达式覆盖
- 选“仅提取音频”后将按音频格式导出
- 在“批量链接”里每行放一个 URL，可一次入队多个任务（顺序下载）
- “失败自动重试次数”可设为 0~10（0 表示失败后不自动重试）
- “重试策略”可选固定间隔或指数退避，并可配置基础延迟与最大退避延迟
- “代理池”支持每行一个代理，失败重试时自动切换到下一个代理
- 配置了“代理池”后，解析视频信息会优先使用第一个代理
- 可勾选“下载完成自动打开目录”，完成后直接在文件管理器打开
- 任务失败后可点击“重排队当前任务”再次入队
- 点击“打开输出目录”可直接在系统文件管理器打开下载位置
- “额外参数”可直接传给 `yt-dlp`，例如：
  - `--cookies cookies.txt`
  - `--proxy http://127.0.0.1:7890`
- 当“代理池”有值时，额外参数中的 `--proxy` 会被代理池覆盖

## 免责声明

请仅下载你有合法权限获取的内容，并遵守平台条款与当地法律。
